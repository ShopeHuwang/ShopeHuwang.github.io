<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#34495e">
  <title>Spring æºç å­¦ä¹  | Shope</title>
  <link rel="alternate" href="path/of/rss" type="application/atom+xml">
  <link rel="shortcut icon" type="image/ico" href="/favicon.ico">
  
<link rel="stylesheet" href="/css/style.css">

  

  

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div class="mobile-header">
    <span><i class="iconfont icon-turnon" id="mobile-nav-toggle"></i></span>
    <div class="mobile-logo">
      <a href="/.">Shope Huwang</a>
    </div>
  </div>
  <div class="page" id="mobile-nav-panel">
    <div class="container">
      <header class="site-nav">
      <div class="nav-content">
        <div class="logo">
          <a href="/">Shope Huwang</a>
        </div>
        <nav class="navbar">
          <ul>
            
              <li class="menu-item">
                <a href="/" class="menu-item-link"><i class="iconfont icon-home"></i>é¦–é¡µ</a>
              </li>
            
              <li class="menu-item">
                <a href="/archives/" class="menu-item-link"><i class="iconfont icon-archive"></i>å½’æ¡£</a>
              </li>
            
              <li class="menu-item">
                <a href="/about/" class="menu-item-link"><i class="iconfont icon-about"></i>å…³äº</a>
              </li>
            
          </ul>
        </nav>
      </div>
</header>

      <div class="banner">
  <div class="show">
    <!-- <img src="/" alt="banner"> -->
    <div class="banner-title">
      
        <div class="post-title">
          Spring æºç å­¦ä¹ 
            <div class="post-tags">
    		    
              <a class="tag-none-link" href="/tags/Aop/" rel="tag">Aop</a> <a class="tag-none-link" href="/tags/Ioc/" rel="tag">Ioc</a>
            
    	      </div>
        </div>
      
    </div>
  </div>
</div>

      <main class="main"id="main">
          <article class="post">
  

  <header>
    <div class="post-title mobile-post-title">
      <h1>Spring æºç å­¦ä¹ </h1>
        <div class="post-tags">
        
          <a class="tag-none-link" href="/tags/Aop/" rel="tag">Aop</a> <a class="tag-none-link" href="/tags/Ioc/" rel="tag">Ioc</a>
        
        </div>
    </div>
    <div class="post-meta">
      <span class="post-time"><i class="iconfont icon-calendar"></i>2020-12-06</span>
      
          
            <i class="iconfont icon-divide"></i>
            <i class="iconfont icon-folder" style="color: #8a8a8a;"></i>
            <a class="post-category" href="/categories/Spring/">Spring</a>
          
      
      <!----------------------------------->
        
      <!----------------------------------->
    </div>
  </header>
  
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Spring-IoC-%E5%AE%B9%E5%99%A8%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-text">ä¸€ã€Spring IoC å®¹å™¨åŠ è½½è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9E%E4%BE%8B%E5%8C%96ApplicationContext%E2%80%93AnnotationConfigApplicationContext"><span class="toc-text">1ã€å®ä¾‹åŒ–ApplicationContextâ€“AnnotationConfigApplicationContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%AE%9E%E4%BE%8B%E5%8C%96BeanFactory%E2%80%93DefaultListableBeanFactory%EF%BC%9A"><span class="toc-text">2ã€å®ä¾‹åŒ–BeanFactoryâ€“DefaultListableBeanFactoryï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%AE%9E%E4%BE%8B%E5%8C%96BeanDefinitionReader%E2%80%93AnnotatedBeanDefinitionReader%EF%BC%9A"><span class="toc-text">3ã€å®ä¾‹åŒ–BeanDefinitionReaderâ€“AnnotatedBeanDefinitionReaderï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E5%AE%9E%E4%BE%8B%E5%8C%96%E2%80%9C%E5%88%9B%E4%B8%96%E7%BA%AA%E2%80%9D%E7%9A%84Bean"><span class="toc-text">3.1å®ä¾‹åŒ–â€œåˆ›ä¸–çºªâ€çš„Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-gt-%E9%85%8D%E7%BD%AE%E7%B1%BB%E7%9A%84%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%9AConfigurationClassPostProcessor"><span class="toc-text">1&gt; é…ç½®ç±»çš„åç½®å¤„ç†å™¨ï¼šConfigurationClassPostProcessor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-gt-internalAutowiredAnnotationProcessor%EF%BC%9A%E7%94%A8%E4%BA%8E%E8%A7%A3%E6%9E%90-Configuration%E3%80%81-ComponentScan%E3%80%81-ComponentScans%E4%BB%A5%E5%8F%8A-Import%E6%B3%A8%E8%A7%A3"><span class="toc-text">2&gt; internalAutowiredAnnotationProcessorï¼šç”¨äºè§£æ@Configurationã€@ComponentScanã€@ComponentScansä»¥åŠ@Importæ³¨è§£</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-gt-internalAutowiredAnnotationProcessor%EF%BC%9A%E8%A7%A3%E6%9E%90-Autowired%E3%80%81-Value%E6%B3%A8%E8%A7%A3"><span class="toc-text">3&gt;internalAutowiredAnnotationProcessorï¼šè§£æ@Autowiredã€@Valueæ³¨è§£</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-gt-internalEventListenerProcessor%EF%BC%9ASpring%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%9B%91%E5%90%AC"><span class="toc-text">4&gt;internalEventListenerProcessorï¼šSpringäº‹ä»¶çš„ç›‘å¬</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%AE%9E%E4%BE%8B%E5%8C%96BeanDefinitionScanner%E2%80%93ClassPathBeanDefinitionScanner%EF%BC%9A"><span class="toc-text">4ã€å®ä¾‹åŒ–BeanDefinitionScannerâ€“ClassPathBeanDefinitionScannerï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%B3%A8%E5%86%8C%E9%85%8D%E7%BD%AE%E7%B1%BB%E4%B8%BABeanDefinitio%E2%80%93AnnotatedGenericBeanDefinition"><span class="toc-text">5ã€æ³¨å†Œé…ç½®ç±»ä¸ºBeanDefinitioâ€“AnnotatedGenericBeanDefinition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E8%BF%9B%E5%85%A5%E5%88%B0AnnotationConfigApplicationContext-Class-lt-gt-%E2%80%A6-componentClasses-%E7%9A%84%E7%AC%AC%E4%B8%89%E8%A1%8C%E4%BB%A3%E7%A0%81%EF%BC%9Arefresh"><span class="toc-text">6ã€è¿›å…¥åˆ°AnnotationConfigApplicationContext(Class&lt;?&gt;â€¦ componentClasses)çš„ç¬¬ä¸‰è¡Œä»£ç ï¼šrefresh()</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96"><span class="toc-text">å¾ªç¯ä¾èµ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-text">é—®é¢˜ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#BeanFactory"><span class="toc-text">BeanFactory:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BeanFactory%E4%B8%8EApplicationContext"><span class="toc-text">BeanFactoryä¸ApplicationContext:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BeanFactory%E5%92%8CFactoryBean%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9A"><span class="toc-text">BeanFactoryå’ŒFactoryBeançš„åŒºåˆ«ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Envent"><span class="toc-text">Spring Envent</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Spring-AOP"><span class="toc-text">äºŒã€Spring AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP"><span class="toc-text">AOP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AspectJ"><span class="toc-text">AspectJ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-AOP"><span class="toc-text">Spring AOP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Spring%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-text">ä¸‰ã€Springå£°æ˜å¼äº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%BE%85%E7%BB%AD"><span class="toc-text">æ›´æ–°å¾…ç»­</span></a></li></ol></li></ol>
    </div>
  </div>


  <div class="post-content">
    <p>[^ğŸ‘¦]: Shope write</p>
<h2 id="ä¸€ã€Spring-IoC-å®¹å™¨åŠ è½½è¿‡ç¨‹"><a href="#ä¸€ã€Spring-IoC-å®¹å™¨åŠ è½½è¿‡ç¨‹" class="headerlink" title="ä¸€ã€Spring IoC å®¹å™¨åŠ è½½è¿‡ç¨‹"></a>ä¸€ã€Spring IoC å®¹å™¨åŠ è½½è¿‡ç¨‹</h2><p>å…³é”®åè¯è§£é‡Šï¼š</p>
<p><strong>BeanDefinition</strong>ï¼šå°±æ˜¯BeanFactoryç”¨äºç”Ÿäº§Beançš„è®¾è®¡å›¾ï¼Œå®šä¹‰æ¯ä¸ªBeançš„ç‰¹æ€§</p>
<p><strong>BeanFactoryPostProcessor</strong>ï¼šç”¨äºä¿®æ”¹BeanDefinition</p>
<p><strong>BeanDefinitionRegisterPostProcessor</strong>ï¼šç”¨äºæ³¨å†ŒBeanDefinition</p>
<p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/5f18298a7d9c0835d38a57c0"><strong>IoCè¯¦ç»†æµç¨‹</strong></a></p>
<h3 id="1ã€å®ä¾‹åŒ–ApplicationContextâ€“AnnotationConfigApplicationContext"><a href="#1ã€å®ä¾‹åŒ–ApplicationContextâ€“AnnotationConfigApplicationContext" class="headerlink" title="1ã€å®ä¾‹åŒ–ApplicationContextâ€“AnnotationConfigApplicationContext"></a>1ã€å®ä¾‹åŒ–ApplicationContextâ€“AnnotationConfigApplicationContext</h3><h3 id="2ã€å®ä¾‹åŒ–BeanFactoryâ€“DefaultListableBeanFactoryï¼š"><a href="#2ã€å®ä¾‹åŒ–BeanFactoryâ€“DefaultListableBeanFactoryï¼š" class="headerlink" title="2ã€å®ä¾‹åŒ–BeanFactoryâ€“DefaultListableBeanFactoryï¼š"></a>2ã€å®ä¾‹åŒ–BeanFactoryâ€“DefaultListableBeanFactoryï¼š</h3><p>åœ¨<strong>AnnotationConfigApplicationContext</strong>çš„<strong>çˆ¶ç±»æ„é€ å™¨</strong>ä¸­å®ä¾‹åŒ–</p>
<p><img src="https://i.loli.net/2020/12/16/msa6xjQvr8l3GDe.png" alt="DefaultListableBeanFactory_relationship.PNG"></p>
<ul>
<li><strong>DefaultListableBeanFactory</strong>æ˜¯<strong>BeanDefinitionRegistry</strong>çš„å®ç°ç±»<ul>
<li><strong>BeanDefinitionRegistry</strong>ï¼šç”¨äºæ³¨å†ŒBeanDefinition(Beanå®šä¹‰)</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">GenericApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.customClassLoader = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.refreshed = <span class="keyword">new</span> AtomicBoolean();</span><br><span class="line">    <span class="keyword">this</span>.beanFactory = <span class="keyword">new</span> DefaultListableBeanFactory();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3ã€å®ä¾‹åŒ–BeanDefinitionReaderâ€“AnnotatedBeanDefinitionReaderï¼š"><a href="#3ã€å®ä¾‹åŒ–BeanDefinitionReaderâ€“AnnotatedBeanDefinitionReaderï¼š" class="headerlink" title="3ã€å®ä¾‹åŒ–BeanDefinitionReaderâ€“AnnotatedBeanDefinitionReaderï¼š"></a>3ã€å®ä¾‹åŒ–BeanDefinitionReaderâ€“AnnotatedBeanDefinitionReaderï¼š</h3><p>åœ¨<strong>AnnotationConfigApplicationContext</strong>æ„é€ å™¨ä¸­å®ä¾‹åŒ–</p>
<h4 id="3-1å®ä¾‹åŒ–â€œåˆ›ä¸–çºªâ€çš„Bean"><a href="#3-1å®ä¾‹åŒ–â€œåˆ›ä¸–çºªâ€çš„Bean" class="headerlink" title="3.1å®ä¾‹åŒ–â€œåˆ›ä¸–çºªâ€çš„Bean"></a>3.1å®ä¾‹åŒ–â€œåˆ›ä¸–çºªâ€çš„Bean</h4><p>â€‹        è¿›å…¥è·¯å¾„ï¼š    <strong>AnnotatedBeanDefinitionReader</strong>æ–‡ä»¶çš„<strong>AnnotationConfigUtils.registerAnnotationConfigProcessors(this.registry);</strong></p>
<p>â€‹                                ğŸ‘‡</p>
<p>â€‹                                <strong>AnnotationConfigUtils</strong>æ–‡ä»¶çš„ <strong>registerAnnotationConfigProcessovrs</strong></p>
<h5 id="1-gt-é…ç½®ç±»çš„åç½®å¤„ç†å™¨ï¼šConfigurationClassPostProcessor"><a href="#1-gt-é…ç½®ç±»çš„åç½®å¤„ç†å™¨ï¼šConfigurationClassPostProcessor" class="headerlink" title="1&gt; é…ç½®ç±»çš„åç½®å¤„ç†å™¨ï¼šConfigurationClassPostProcessor"></a>1&gt; é…ç½®ç±»çš„åç½®å¤„ç†å™¨ï¼šConfigurationClassPostProcessor</h5><h5 id="2-gt-internalAutowiredAnnotationProcessorï¼šç”¨äºè§£æ-Configurationã€-ComponentScanã€-ComponentScansä»¥åŠ-Importæ³¨è§£"><a href="#2-gt-internalAutowiredAnnotationProcessorï¼šç”¨äºè§£æ-Configurationã€-ComponentScanã€-ComponentScansä»¥åŠ-Importæ³¨è§£" class="headerlink" title="2&gt; internalAutowiredAnnotationProcessorï¼šç”¨äºè§£æ@Configurationã€@ComponentScanã€@ComponentScansä»¥åŠ@Importæ³¨è§£"></a>2&gt; internalAutowiredAnnotationProcessorï¼šç”¨äºè§£æ@Configurationã€@ComponentScanã€@ComponentScansä»¥åŠ@Importæ³¨è§£</h5><h5 id="3-gt-internalAutowiredAnnotationProcessorï¼šè§£æ-Autowiredã€-Valueæ³¨è§£"><a href="#3-gt-internalAutowiredAnnotationProcessorï¼šè§£æ-Autowiredã€-Valueæ³¨è§£" class="headerlink" title="3&gt;internalAutowiredAnnotationProcessorï¼šè§£æ@Autowiredã€@Valueæ³¨è§£"></a>3&gt;internalAutowiredAnnotationProcessorï¼šè§£æ@Autowiredã€@Valueæ³¨è§£</h5><h5 id="4-gt-internalEventListenerProcessorï¼šSpringäº‹ä»¶çš„ç›‘å¬"><a href="#4-gt-internalEventListenerProcessorï¼šSpringäº‹ä»¶çš„ç›‘å¬" class="headerlink" title="4&gt;internalEventListenerProcessorï¼šSpringäº‹ä»¶çš„ç›‘å¬"></a>4&gt;internalEventListenerProcessorï¼šSpringäº‹ä»¶çš„ç›‘å¬</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Set&lt;BeanDefinitionHolder&gt; <span class="title">registerAnnotationConfigProcessors</span><span class="params">(BeanDefinitionRegistry registry, <span class="meta">@Nullable</span> Object source)</span> </span>&#123;</span><br><span class="line">    .....</span><br><span class="line"><span class="keyword">if</span> (!registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.annotation.internalConfigurationAnnotationProcessor&quot;</span>)) &#123;</span><br><span class="line">    		<span class="comment">//	å®ä¾‹åŒ–é…ç½®ç±»çš„åç½®å¤„ç†å™¨ConfigurationClassPostProcessor</span></span><br><span class="line">            def = <span class="keyword">new</span> RootBeanDefinition(ConfigurationClassPostProcessor.class);</span><br><span class="line">            def.setSource(source);</span><br><span class="line">            beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.annotation.internalConfigurationAnnotationProcessor&quot;</span>));<span class="comment">//è¿™ä¸ªç±»ç”¨äºè§£æé…ç½®ç±»ä¿¡æ¯</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.annotation.internalAutowiredAnnotationProcessor&quot;</span>)) &#123;</span><br><span class="line">            def = <span class="keyword">new</span> RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class);</span><br><span class="line">            def.setSource(source);</span><br><span class="line">            beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.annotation.internalAutowiredAnnotationProcessor&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (jsr250Present &amp;&amp; !registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.annotation.internalCommonAnnotationProcessor&quot;</span>)) &#123;</span><br><span class="line">            def = <span class="keyword">new</span> RootBeanDefinition(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">            def.setSource(source);</span><br><span class="line">            beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.annotation.internalCommonAnnotationProcessor&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (jpaPresent &amp;&amp; !registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.annotation.internalPersistenceAnnotationProcessor&quot;</span>)) &#123;</span><br><span class="line">            def = <span class="keyword">new</span> RootBeanDefinition();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                def.setBeanClass(ClassUtils.forName(<span class="string">&quot;org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor&quot;</span>, AnnotationConfigUtils.class.getClassLoader()));<span class="comment">//	å®ä¾‹åŒ–Beançš„åç½®å¤„ç†å™¨</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException var6) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Cannot load optional framework class: org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor&quot;</span>, var6);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            def.setSource(source);</span><br><span class="line">            beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.annotation.internalPersistenceAnnotationProcessor&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.event.internalEventListenerProcessor&quot;</span>)) &#123;</span><br><span class="line">            def = <span class="keyword">new</span> RootBeanDefinition(EventListenerMethodProcessor.class);</span><br><span class="line">            def.setSource(source);</span><br><span class="line">            beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.event.internalEventListenerProcessor&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.event.internalEventListenerFactory&quot;</span>)) &#123;</span><br><span class="line">            def = <span class="keyword">new</span> RootBeanDefinition(DefaultEventListenerFactory.class);</span><br><span class="line">            def.setSource(source);</span><br><span class="line">            beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.event.internalEventListenerFactory&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4ã€å®ä¾‹åŒ–BeanDefinitionScannerâ€“ClassPathBeanDefinitionScannerï¼š"><a href="#4ã€å®ä¾‹åŒ–BeanDefinitionScannerâ€“ClassPathBeanDefinitionScannerï¼š" class="headerlink" title="4ã€å®ä¾‹åŒ–BeanDefinitionScannerâ€“ClassPathBeanDefinitionScannerï¼š"></a>4ã€å®ä¾‹åŒ–BeanDefinitionScannerâ€“ClassPathBeanDefinitionScannerï¼š</h3><p><strong>åœ¨AnnotationConfigApplicationContext<a href="">æ„é€ å™¨ä¸­</a>å®ä¾‹åŒ–</strong></p>
<h3 id="5ã€æ³¨å†Œé…ç½®ç±»ä¸ºBeanDefinitioâ€“AnnotatedGenericBeanDefinition"><a href="#5ã€æ³¨å†Œé…ç½®ç±»ä¸ºBeanDefinitioâ€“AnnotatedGenericBeanDefinition" class="headerlink" title="5ã€æ³¨å†Œé…ç½®ç±»ä¸ºBeanDefinitioâ€“AnnotatedGenericBeanDefinition"></a>5ã€æ³¨å†Œé…ç½®ç±»ä¸ºBeanDefinitioâ€“AnnotatedGenericBeanDefinition</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AnnotationConfigApplicationContext</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>();</span><br><span class="line">    <span class="keyword">this</span>.register(componentClasses); <span class="comment">//åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ³¨å†Œï¼Œè¿™ä¸ªä¸€ä¸ªé—¨é¢æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">this</span>.refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6ã€è¿›å…¥åˆ°AnnotationConfigApplicationContext-Class-lt-gt-â€¦-componentClasses-çš„ç¬¬ä¸‰è¡Œä»£ç ï¼šrefresh"><a href="#6ã€è¿›å…¥åˆ°AnnotationConfigApplicationContext-Class-lt-gt-â€¦-componentClasses-çš„ç¬¬ä¸‰è¡Œä»£ç ï¼šrefresh" class="headerlink" title="6ã€è¿›å…¥åˆ°AnnotationConfigApplicationContext(Class&lt;?&gt;â€¦ componentClasses)çš„ç¬¬ä¸‰è¡Œä»£ç ï¼šrefresh()"></a>6ã€è¿›å…¥åˆ°AnnotationConfigApplicationContext(Class&lt;?&gt;â€¦ componentClasses)çš„ç¬¬ä¸‰è¡Œä»£ç ï¼šrefresh()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">            <span class="comment">//åˆ·æ–°é¢„å¤„ç†ï¼Œä¿å­˜äº†å®¹å™¨çš„å¯åŠ¨æ—¶é—´ï¼Œå¯åŠ¨æ ‡å¿—ç­‰</span></span><br><span class="line">            <span class="keyword">this</span>.prepareRefresh();</span><br><span class="line">            ConfigurableListableBeanFactory beanFactory = <span class="keyword">this</span>.obtainFreshBeanFactory();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">this</span>.prepareBeanFactory(beanFactory);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.postProcessBeanFactory(beanFactory);</span><br><span class="line">                <span class="keyword">this</span>.invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">                <span class="keyword">this</span>.registerBeanPostProcessors(beanFactory);</span><br><span class="line">                <span class="keyword">this</span>.initMessageSource();</span><br><span class="line">                <span class="keyword">this</span>.initApplicationEventMulticaster();</span><br><span class="line">                <span class="keyword">this</span>.onRefresh();</span><br><span class="line">                <span class="keyword">this</span>.registerListeners();</span><br><span class="line">                <span class="keyword">this</span>.finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">                <span class="keyword">this</span>.finishRefresh();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (BeansException var9) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isWarnEnabled()) &#123;</span><br><span class="line">         		 .....</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">this</span>.destroyBeans();</span><br><span class="line">                <span class="keyword">this</span>.cancelRefresh(var9);</span><br><span class="line">                <span class="keyword">throw</span> var9;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.resetCommonCaches();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">invokeBeanFactoryPostProcessors</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line"><span class="comment">// BeanFactoryPostProcessorå¯ä»¥æ‰‹åŠ¨æ·»åŠ ï¼Œå³ï¼šannotationConfigApplicationContext.addBeanFactoryPostProcessor(XXX);</span></span><br><span class="line">     PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, <span class="keyword">this</span>.getBeanFactoryPostProcessors());</span><br><span class="line">     <span class="keyword">if</span> (beanFactory.getTempClassLoader() == <span class="keyword">null</span> &amp;&amp; beanFactory.containsBean(<span class="string">&quot;loadTimeWeaver&quot;</span>)) &#123;</span><br><span class="line">         beanFactory.addBeanPostProcessor(<span class="keyword">new</span> LoadTimeWeaverAwareProcessor(beanFactory));</span><br><span class="line">         beanFactory.setTempClassLoader(<span class="keyword">new</span> ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h4 id="å¾ªç¯ä¾èµ–"><a href="#å¾ªç¯ä¾èµ–" class="headerlink" title="å¾ªç¯ä¾èµ–"></a>å¾ªç¯ä¾èµ–</h4><ul>
<li>Springè§£å†³å¾ªç¯ä¾èµ–é—®é¢˜åªå¯¹äºSingletonæ¨¡å¼ä¸‹çš„ï¼Œå¤šä¾‹æ— æ³•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li>
</ul>
<p>â€‹    Aéœ€è¦æ³¨å…¥Bï¼ŒBæœ‰éœ€è¦Açš„æ³¨å…¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">  <span class="meta">@Autowird</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">B</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line"><span class="meta">@Autowird</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€çº§ç¼“å­˜ï¼šsingletonObjectï¼ˆConcurrentHashMapï¼‰<strong>å•ä¾‹ç¼“å­˜æ± </strong> ï¼Œç”¨äºå­˜æ”¾<strong>æˆç†Ÿ</strong>(å·²ç»å®Œæˆèµ‹å€¼)çš„Beanã€‚</p>
<p>äºŒçº§ç¼“å­˜ï¼šearlySingletonObject ï¼ˆHashMapï¼‰ è§£å†³å¾ªç¯ä¾èµ–ï¼Œç”¨äºå­˜<strong>å‚¨çº¯å‡€æ€</strong>(æ²¡æœ‰èµ‹å€¼)çš„Beanã€‚</p>
<p>ä¸‰çº§ç¼“å­˜ï¼šsingletonFactories ï¼ˆHashMapï¼‰AOPï¼Œä»£ç è§£è€¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€çº§ç¼“å­˜ ä¹Ÿå« å•ä¾‹æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> ConcurrentHashMap&lt;String, Object&gt;(<span class="number">256</span>);</span><br><span class="line"><span class="comment">//	ä¸‰çº§ç¼“å­˜</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> HashMap&lt;String, ObjectFactory&lt;?&gt;&gt;(<span class="number">16</span>);</span><br><span class="line"><span class="comment">// äºŒçº§ç¼“å­˜</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> HashMap&lt;String, Object&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>åˆ¤æ–­æ˜¯å¦ä¸ºå¾ªç¯ä¾èµ–çš„æ ‡å¿—ï¼šäºŒçº§ç¼“å­˜çš„Mapä¸ºnullã€‚</p>
<p><strong>é—®é¢˜ï¼šSpringå¦‚ä½•é¿å…è¯»å–åˆ°ä¸å®Œæ•´çš„Bean?</strong></p>
<p>éœ€è¦ä½¿ç”¨äºŒçº§ç¼“å­˜ä»¥åŠé”ï¼Œåœ¨å¯¹è±¡åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¼šåˆ°å•ä¾‹æ± ä¸­è·å–å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸ºnullä¸”å¯¹è±¡æ­£åœ¨åˆ›å»ºï¼Œä¼šé˜»å¡çº¿ç¨‹ï¼Œç­‰å¾…åˆ°çº¿ç¨‹æ¢å¤åï¼Œå†åˆ°äºŒçº§ç¼“å­˜ä¸­è·å–ï¼Œè·å–åˆ°å€¼å°±è¿”å›ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šæ­¤æ—¶çš„å¯¹è±¡æ˜¯çº¯å‡€æ€çš„ï¼Œåœ¨èµ‹å€¼åè¯¥å¯¹è±¡ä¼šè¢«æ·»åŠ åˆ°ä¸€çº§ç¼“å­˜ï¼Œå¹¶ç§»é™¤äºŒçº§ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚åœ¨å¯¹è±¡ä¸ºçº¯å‡€æ€çš„æ—¶å€™è¿”å›çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œåœ¨å¯¹è±¡èµ‹å€¼åï¼Œè¯¥å¼•ç”¨å°±æ˜¯æˆç†Ÿçš„å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// source code åšä¸€ä¸ª double check</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> Object <span class="title">getSingleton</span><span class="params">(String beanName, <span class="keyword">boolean</span> allowEarlyReference)</span> </span>&#123;</span><br><span class="line">       Object singletonObject = <span class="keyword">this</span>.singletonObjects.get(beanName);</span><br><span class="line">       <span class="comment">//	ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼šåˆ¤æ–­å•ä¾‹æ˜¯å¦ä¸ºnull ä¸” å•ä¾‹æ˜¯å¦æ­£åœ¨åˆ›å»º</span></span><br><span class="line">       <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">           <span class="comment">//	é”ä½å•ä¾‹æ± å¯¹è±¡</span></span><br><span class="line">           <span class="keyword">synchronized</span>(<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">               <span class="comment">//	ä» äºŒçº§ç¼“å­˜ ä¸­è·å–å¯¹è±¡</span></span><br><span class="line">               singletonObject = <span class="keyword">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">                <span class="comment">//	åšç¬¬äºŒæ¬¡æ£€æŸ¥ï¼Œå†åˆ¤æ–­è·å–çš„å¯¹è±¡æ˜¯å¦ä¸ºnull</span></span><br><span class="line">               <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">                   ObjectFactory&lt;?&gt; singletonFactory = (ObjectFactory)<span class="keyword">this</span>.singletonFactories.get(beanName);</span><br><span class="line">                   <span class="keyword">if</span> (singletonFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       <span class="comment">//	è¿”å› çº¯å‡€æ€ çš„å¯¹è±¡</span></span><br><span class="line">                       singletonObject = singletonFactory.getObject</span><br><span class="line">                           <span class="comment">//	å°†å¯¹è±¡æ·»åŠ åˆ° äºŒçº§ç¼“å­˜</span></span><br><span class="line">                       <span class="keyword">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                       <span class="keyword">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="keyword">return</span> singletonObject;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>åœ¨Springå†…éƒ¨ï¼ŒæŠŠå¸¦ä¸Šäº†**@Configuration<strong>çš„é…ç½®ç±»ç§°ä¹‹ä¸º</strong>Fullé…ç½®ç±»<strong>ï¼ŒæŠŠæ²¡æœ‰å¸¦ä¸Š@Configurationï¼Œä½†æ˜¯å¸¦ä¸Šäº†@Component @ComponentScan @Import @ImportResourceç­‰æ³¨è§£çš„é…ç½®ç±»ç§°ä¹‹ä¸º</strong>Liteé…ç½®ç±»**ã€‚</p>
<h4 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h4><h5 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory:"></a><strong>BeanFactory:</strong></h5><p>æ˜¯ä¸€ä¸ªBeanå·¥å‚ï¼Œæ˜¯Springé¡¶å±‚çš„æ ¸å¿ƒæ¥å£ï¼Œå…¶ä½œç”¨æ˜¯æ ¹æ®BeanDefinitionåˆå§‹åŒ–Beanã€‚</p>
<h5 id="BeanFactoryä¸ApplicationContext"><a href="#BeanFactoryä¸ApplicationContext" class="headerlink" title="BeanFactoryä¸ApplicationContext:"></a><strong>BeanFactoryä¸ApplicationContext:</strong></h5><p>BeanFactoryä¸“æ³¨äºç”Ÿäº§Beanï¼Œæœ€å¤§çš„èŒè´£æ˜¯ç”Ÿäº§Beanã€‚ApplicationContextä¼šè·å–Beançš„é…ç½®ï¼Œæ³¨å†ŒBeanDefinitionå®šä¹‰Beanï¼Œå‚æ•°æ³¨å…¥ç­‰ï¼Œæœ€åè°ƒç”¨BeanFactoryçš„getBean()æ–¹æ³•ç”Ÿäº§Beanã€‚</p>
<h5 id="BeanFactoryå’ŒFactoryBeançš„åŒºåˆ«ï¼š"><a href="#BeanFactoryå’ŒFactoryBeançš„åŒºåˆ«ï¼š" class="headerlink" title="BeanFactoryå’ŒFactoryBeançš„åŒºåˆ«ï¼š"></a><strong>BeanFactoryå’ŒFactoryBeançš„åŒºåˆ«ï¼š</strong></h5><p>BeanFactoryç”¨äºç”Ÿäº§Bean,è€ŒFactoryBeanç”¨äºä¿®æ”¹åŸæ¥çš„Beanï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„Beanã€‚</p>
<p>é…ç½®ç±»ï¼šxmlé…ç½®ã€æ³¨è§£ã€‚</p>
<p>XMLï¼šnew ClassPathXmlApplicationCopntext(â€œxmlâ€);</p>
<p>æ³¨è§£ï¼šAnnotationConfigApplicationContext(XXXBean.class)</p>
<p><strong>BeanDefinition</strong>ï¼šè®¾ç½®Beançš„åŠ è½½æ–¹å¼ï¼Œç”Ÿå‘½å‘¨æœŸç­‰ã€‚(ç›¸å½“äºbeançš„è®¾è®¡å›¾)</p>
<p><strong>BeanDefinitionRegistry</strong>ï¼šæ³¨å†ŒBeanå®šä¹‰ï¼ˆæ³¨å†Œbeançš„è®¾è®¡å›¾ï¼‰</p>
<p><strong>BeanFactory</strong> ï¼šè´Ÿè´£ç”Ÿäº§Beanï¼Œä½¿ç”¨ç®€å•å·¥å‚æ–¹æ³•å®ç°ã€‚ï¼ˆæ ¹æ®è®¾è®¡å›¾ç”Ÿäº§beanï¼‰</p>
<h3 id="Spring-Envent"><a href="#Spring-Envent" class="headerlink" title="Spring Envent"></a>Spring Envent</h3><p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/5f5075c763768959e2d109df#map">https://www.processon.com/view/link/5f5075c763768959e2d109df#map</a></p>
<h2 id="äºŒã€Spring-AOP"><a href="#äºŒã€Spring-AOP" class="headerlink" title="äºŒã€Spring AOP"></a>äºŒã€Spring AOP</h2><p>1.è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰ï¼šè¿æ¥ç‚¹æ˜¯åœ¨åº”ç”¨æ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ’å…¥åˆ‡é¢ï¼ˆAspectï¼‰çš„ä¸€ä¸ªç‚¹ã€‚è¿™äº›ç‚¹å¯ä»¥æ˜¯è°ƒç”¨æ–¹æ³•æ—¶ã€ç”šè‡³ä¿®æ”¹ä¸€ä¸ªå­—æ®µæ—¶ã€‚</p>
<p>2.åˆ‡ç‚¹ï¼ˆPointcutï¼‰ï¼šåˆ‡ç‚¹æ˜¯æŒ‡é€šçŸ¥ï¼ˆAdviceï¼‰æ‰€è¦ç»‡å…¥ï¼ˆWeavingï¼‰çš„å…·ä½“ä½ç½®ã€‚</p>
<p>ç†è§£ï¼šè¿æ¥ç‚¹æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ¦‚å¿µï¼Œå¯ä»¥ç†è§£ä¸ºæ‰€æœ‰æ»¡è¶³<strong>åˆ‡ç‚¹</strong>æ‰«ææ¡ä»¶çš„æ‰€æœ‰çš„æ—¶æœºã€‚</p>
<h4 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h4><ul>
<li>åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°ï¼Œé»˜è®¤ï¼šå¦‚æœä½¿ç”¨æ¥å£ï¼Œåˆ™ JDK æä¾›åŠ¨æ€ä»£ç†å®ç°ï¼›å¦‚æœæ²¡æœ‰æ¥å£ï¼Œä½¿ç”¨CGLIBå®ç°ï¼›</li>
<li>Spring AOP ä¾èµ–äº IoC  ã€‚</li>
<li>Spring AOP åªèƒ½åªèƒ½ä½œç”¨äºSpring å®¹å™¨ä¸­çš„Bean ï¼Œä½¿ç”¨Javaä»£ç å®ç°ï¼Œåªèƒ½ä½œç”¨äºBeanæ–¹æ³•ã€‚</li>
</ul>
<h4 id="AspectJ"><a href="#AspectJ" class="headerlink" title="AspectJ"></a>AspectJ</h4><p>æ¥è‡ªäº Eclipse åŸºé‡‘ä¼šï¼Œlinkï¼š<a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj">https://www.eclipse.org/aspectj</a> å±äºé™æ€ç»‡å…¥ï¼Œå®ƒæ˜¯é€šè¿‡ä¿®æ”¹ä»£ç æ¥å®ç°çš„ï¼Œ</p>
<p>å®ƒçš„ç»‡å…¥æ—¶æœºå¯ä»¥æ˜¯ï¼š </p>
<ul>
<li>Compile-time weavingï¼šç¼–è¯‘æœŸç»‡å…¥ï¼Œå¦‚ç±» A ä½¿ç”¨ AspectJ æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œç±» B å¼• ç”¨äº†å®ƒï¼Œè¿™ä¸ªåœºæ™¯å°±éœ€è¦ç¼–è¯‘æœŸçš„æ—¶å€™å°±è¿›è¡Œç»‡å…¥ï¼Œå¦åˆ™æ²¡æ³•ç¼–è¯‘ç±» Bã€‚ </li>
</ul>
<ul>
<li>Post-compile weavingï¼šç¼–è¯‘åç»‡å…¥ï¼Œä¹Ÿå°±æ˜¯å·²ç»ç”Ÿæˆäº† .class æ–‡ä»¶ï¼Œæˆ–å·²ç»æ‰“æˆ jar åŒ… äº†ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦å¢å¼ºå¤„ç†çš„è¯ï¼Œå°±è¦ç”¨åˆ°ç¼–è¯‘åç»‡å…¥ã€‚</li>
</ul>
<ul>
<li><p>Load-time weavingï¼šæŒ‡çš„æ˜¯åœ¨åŠ è½½ç±»çš„æ—¶å€™è¿›è¡Œç»‡å…¥ï¼Œè¦å®ç°è¿™ä¸ªæ—¶æœŸçš„ç»‡å…¥ï¼Œæœ‰å‡  ç§å¸¸è§çš„æ–¹æ³•ã€‚</p>
<p>â€‹    1ã€è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å¹²è¿™ä¸ªï¼Œè¿™ä¸ªåº”è¯¥æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„åŠæ³•ï¼Œåœ¨è¢«ç»‡å…¥ç±»åŠ  è½½åˆ° JVM å‰å»å¯¹å®ƒè¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨åŠ è½½çš„æ—¶å€™å®šä¹‰è¡Œä¸ºäº†ã€‚</p>
<p>â€‹    2ã€åœ¨ JVM å¯åŠ¨çš„æ—¶å€™ æŒ‡å®š AspectJ æä¾›çš„ agentï¼š-javaagent:xxx/xxx/aspectjweaver.jar</p>
</li>
</ul>
<h4 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h4><p>  Spring AOP ä¸€å…±æœ‰ä¸‰ç§é…ç½®æ–¹å¼ï¼ŒSpring åšåˆ°äº†å¾ˆå¥½åœ°å‘ä¸‹å…¼å®¹ï¼Œæ‰€ä»¥ç‰ˆæœ¬ç‰ˆæœ¬æ›´æ–°ä¸éœ€è¦æ‹…å¿ƒä»£ç é‡æ„ã€‚ </p>
<p>  Spring 1.2 åŸºäºæ¥å£çš„é…ç½®ï¼šæœ€æ—©çš„ Spring AOP æ˜¯å®Œå…¨åŸºäºå‡ ä¸ªæ¥å£ï¼ˆMethodBeforeAdviceã€MethodInterceptorï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//	å®ç°	MethodBeforeAdvice ç±»ä¼¼ å‰ç½®é€šçŸ¥ @Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TulingLogAdvice</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        String methodName = method.getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€&quot;</span> + methodName + <span class="string">&quot;ã€‘çš„&lt;å‰ç½®é€šçŸ¥&gt;,å…¥å‚&quot;</span> + Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//	å®ç° MethodInterceptor	ç±»ä¼¼ ç¯ç»•ç½®é€šçŸ¥ @Around</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TulingLogInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(getClass()+<span class="string">&quot;è°ƒç”¨æ–¹æ³•å‰&quot;</span>);</span><br><span class="line">        Object ret=invocation.proceed();</span><br><span class="line">        System.out.println(getClass()+<span class="string">&quot;è°ƒç”¨æ–¹æ³•å&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>â€‹    Spring 2.0 schema-based é…ç½®ï¼šSpring 2.0 ä»¥åä½¿ç”¨ XML çš„æ–¹å¼æ¥é…ç½®ï¼Œä½¿ç”¨ å‘½åç©ºé—´  </p>
<p>â€‹    Spring 2.0 @AspectJ é…ç½®ï¼šä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®ã€‚</p>
<p><strong>åŸºäºæ³¨è§£çš„é…ç½®ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyAspectJ</span> </span>&#123;</span><br><span class="line">    <span class="comment">//	è®© com.shope.XXXServiceImpl å®ç° om.shope.UserService æ¥å£</span></span><br><span class="line">    <span class="meta">@DeclareParents(value=&quot;com.shope.UserService&quot;,defaultImpl=com.shope.XXXServiceImpl.class)</span></span><br><span class="line">    <span class="keyword">private</span> XXXService service;</span><br><span class="line">    <span class="comment">//	å®šä¹‰åˆ‡ç‚¹</span></span><br><span class="line">    <span class="comment">//	AspectJåˆ‡ç‚¹è¡¨è¾¾å¼ï¼šexection( è¿”å›å€¼ åŒ…å.æ–¹æ³•å(å‚æ•°ç±»å‹) &amp;&amp; arg(å‚æ•°å) &amp;&amp; bean(ç›®æ ‡å¯¹è±¡))</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(String com.sharpcj.aopdemo.test1.IBuy.buy(double)) &amp;&amp; args(price) &amp;&amp; bean(girl)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gif</span><span class="params">(<span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//	å®šä¹‰é€šçŸ¥ç±»å‹ï¼š@Around | @Before | @After | @AfterReturning |  @AfterThrowing</span></span><br><span class="line">     <span class="meta">@Around(&quot;gif(price)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">price</span><span class="params">(ProceedingJoinPoint pj, <span class="keyword">double</span> price)</span></span>&#123;</span><br><span class="line">      <span class="comment">// å£°æ˜äº†ä¸€ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œè¯¥æ–¹æ³• price çš„å†…å®¹å¹¶ä¸é‡è¦ï¼Œæ–¹æ³•åä¹Ÿä¸é‡è¦ï¼Œå®é™…ä¸Šå®ƒåªæ˜¯ä½œä¸ºä¸€ä¸ªæ ‡è¯†ï¼Œä¾›é€šçŸ¥ä½¿ç”¨ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;XXX&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è´£ä»»é“¾çš„è°ƒç”¨@Aspectçš„ç±»è§£æï¼Œ</p>
<p>è§£æåˆ‡é¢ï¼šå°†æ‰€æœ‰å¸¦æœ‰</p>
<p>advisoré‡Œé¢æœ‰adviseå’ŒpointCutï¼ˆadvise ä¸º @Beforeä¹‹ç±»æ³¨è§£çš„ä»£ç ï¼‰</p>
<p>æœ‰æ¥å£ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼ŒJDKåŠ¨æ€ä»£ç†è°ƒç”¨æ–¹æ³•ä½¿ç”¨åå°„çš„æ–¹å¼ã€‚</p>
<p>æ²¡æœ‰æ¥å£ä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†ï¼ŒCGLIBä½¿ç”¨ASMåˆ›å»ºå­—èŠ‚ç æ–‡ä»¶ï¼Œä½¿ç”¨ç»§æ‰¿å®ç°ã€‚</p>
<p><strong>JDKçš„åŠ¨æ€ä»£ç†è°ƒç”¨åŠ¨æ€ä»£ç†ç±»ä¸­çš„æ–¹æ³•æ˜¯ä¸ä¼šè§¦å‘ç¬¬äºŒæ¬¡åŠ¨æ€ä»£ç†çš„ã€‚</strong></p>
<p><strong>CGLIBåŠ¨æ€ä»£ç†ç§è®¾ç½® @EnableAspectJAutoProxy(exporse = true)ï¼Œå¯ä»¥å®ç°è°ƒç”¨ä»£ç†é…ç½®ç±»ä¸­çš„å…¶ä»–æ–¹æ³•ä¼šè§¦å‘åŠ¨æ€ä»£ç†ã€‚</strong></p>
<h2 id="ä¸‰ã€Springå£°æ˜å¼äº‹åŠ¡"><a href="#ä¸‰ã€Springå£°æ˜å¼äº‹åŠ¡" class="headerlink" title="ä¸‰ã€Springå£°æ˜å¼äº‹åŠ¡"></a>ä¸‰ã€Springå£°æ˜å¼äº‹åŠ¡</h2><p><strong>@EnableTransactionManagementï¼šå¼€å¯äº‹åŠ¡</strong></p>
<p><strong>@EnableAspjectJAutoProxy( exposeProxy = true )</strong> æš´éœ²äº‹åŠ¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//	åœ¨äº‹åŠ¡Aä¸­è°ƒç”¨äº‹åŠ¡Bï¼Œäº‹åŠ¡ Aã€Béƒ½åœ¨åŒä¸€ä¸ªç±»ä¸­</span></span><br><span class="line"><span class="comment">//	è°ƒç”¨ xxxService çš„ XXXMethodæ–¹æ³•ï¼Œæ‰èƒ½æ­£ç¡®åµŒå¥—ä¸¤ä¸ªäº‹åŠ¡</span></span><br><span class="line"> ((xxxService)AopContext.currentProxy()).XXXMethod();</span><br></pre></td></tr></table></figure>

<p><strong>@Transactional é…ç½®å±æ€§</strong></p>
<p>â€‹        <strong>isolation</strong>ï¼šè®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</p>
<p>â€‹        <strong>propagation</strong>ï¼šäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</p>
<p>â€‹        <strong>noRollbackFor</strong>ï¼šé‚£äº›å¼‚å¸¸äº‹åŠ¡å¯ä»¥ä¸å›æ»š</p>
<p>â€‹        <strong>noRollbackForClassName</strong>ï¼šå¡«å†™çš„å‚æ•°æ˜¯å…¨ç±»å</p>
<p>â€‹        <strong>rollbackFor</strong>ï¼šå“ªäº›å¼‚å¸¸äº‹åŠ¡éœ€è¦å›æ»š</p>
<p>â€‹        <strong>rollbackForClassName</strong>ï¼šå¡«å†™çš„å‚æ•°æ˜¯å…¨ç±»å</p>
<p>â€‹        <strong>readOnly</strong>ï¼šè®¾ç½®äº‹åŠ¡æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡        </p>
<p>â€‹        <strong>timeout</strong>ï¼šäº‹åŠ¡è¶…å‡ºæŒ‡å®šæ‰§è¡Œæ—¶é•¿åè‡ªåŠ¨ç»ˆæ­¢å¹¶å›æ»š,å•ä½æ˜¯ç§’</p>
<p>@Transactionalå¯ä»¥æ ‡æ³¨åœ¨ç±»ã€æ–¹æ³•ã€çˆ¶ç±»ã€æ¥å£ä¸Šï¼ŒSpringè§£ææœºåˆ¶éƒ½ä¼šå»è§£æåˆ°ã€‚</p>
<p><strong>1ã€è®¾ç½®éš”ç¦»çº§åˆ«ï¼ˆisolationï¼‰</strong></p>
<p>ç”¨æ¥è§£å†³å¹¶å‘äº‹åŠ¡æ‰€äº§ç”Ÿä¸€äº›é—®é¢˜ï¼š</p>
<p>å¹¶å‘ï¼š åŒä¸€ä¸ªæ—¶é—´ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œè¯·æ±‚ã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™ä¼šç”Ÿæˆå¹¶å‘é—®é¢˜ï¼šåœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¯¹åŒä¸€ä¸ªæ•°æ®ï¼ˆå˜é‡ã€å¯¹è±¡ï¼‰è¿›è¡Œè¯»å†™æ“ä½œæ‰ä¼šäº§ç”Ÿå¹¶å‘é—®é¢˜</p>
<p>å¹¶å‘ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p>1.è„è¯»    2.ä¸å¯é‡å¤åº¦    3.å¹»å½±è¯»</p>
<p><strong>ä½¿ç”¨æƒ…æ™¯ï¼š</strong></p>
<p>â€‹    1ã€ä¸€ä¸ªäº‹åŠ¡ï¼Œè¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡ä¸­æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œä¼šåœ¨æœ¬äº‹åŠ¡ä¸­äº§ç”Ÿçš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜</p>
<p>â€‹        è§£å†³æ–¹å¼ï¼š@Transactional(isolation = Isolation.<strong>READ_COMMITTED</strong>)</p>
<p>â€‹    2ã€ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–ç›¸åŒçš„æ•°æ®ï¼Œ ä½†æ˜¯è¯»å–çš„ç»“æœä¸ä¸€æ ·ï¼Œ  ä¼šåœ¨æœ¬äº‹åŠ¡ä¸­äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>â€‹        è§£å†³æ–¹å¼ï¼š@Transactional(isolation = Isolation.<strong>REPEATABLE_READ</strong>)</p>
<p>â€‹    3ã€ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡å¯¹æ•°æ®è¿›è¡Œæ•´è¡¨æ•°æ®è¯»å–ï¼ˆç»Ÿè®¡ï¼‰ï¼Œä½†æ˜¯ç»“æœä¸ä¸€æ ·ï¼Œ ä¼šåœ¨æœ¬äº‹åŠ¡ä¸­äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>â€‹            è§£å†³æ–¹å¼ï¼š@Transactional(isolation = Isolation.<strong>SERIALIZABLE</strong>)</p>
<p><strong>éš”ç¦»çº§åˆ«æ¯”è¾ƒ</strong></p>
<p>â€‹    å¹¶å‘å®‰å…¨ï¼šSERIALIZABLE &gt; REPEATABLE_READ &gt; READ_COMMITTED </p>
<p>â€‹    è¿è¡Œæ•ˆç‡ï¼šREAD_COMMITTED &gt; REPEATABLE_READ  &gt; SERIALIZABLE              </p>
<p><strong>2ã€äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§</strong></p>
<table>
<thead>
<tr>
<th><strong>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºç±»å‹</strong></th>
<th><strong>å¤–éƒ¨ä¸å­˜åœ¨äº‹åŠ¡</strong></th>
<th><strong>å¤–éƒ¨å­˜åœ¨äº‹åŠ¡</strong></th>
<th><strong>ä½¿ç”¨æ–¹å¼</strong></th>
</tr>
</thead>
<tbody><tr>
<td>REQUIREDï¼ˆé»˜è®¤ï¼‰</td>
<td>å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td>èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td>
<td>@Transactional(propagation = Propagation.REQUIRED)é€‚ç”¨å¢åˆ æ”¹æŸ¥</td>
</tr>
<tr>
<td>SUPPORTS</td>
<td>ä¸å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td>èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td>
<td>@Transactional(propagation = Propagation.SUPPORTS)é€‚ç”¨æŸ¥è¯¢</td>
</tr>
<tr>
<td>REQUIRES_NEW</td>
<td>å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td>æŒ‚èµ·å¤–éƒ¨äº‹åŠ¡ï¼Œåˆ›å»ºæ–°çš„äº‹åŠ¡</td>
<td>@Transactional(propagation = Propagation.REQUIRES_NEW)é€‚ç”¨å†…éƒ¨äº‹åŠ¡å’Œå¤–éƒ¨äº‹åŠ¡ä¸å­˜åœ¨ä¸šåŠ¡å…³è”æƒ…å†µï¼Œå¦‚æ—¥å¿—</td>
</tr>
<tr>
<td>NOT_SUPPORTED</td>
<td>ä¸å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td>æŒ‚èµ·å¤–éƒ¨äº‹åŠ¡</td>
<td>@Transactional(propagation = Propagation.NOT_SUPPORTED)ä¸å¸¸ç”¨</td>
</tr>
<tr>
<td>NEVER</td>
<td>ä¸å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td>æŠ›å‡ºå¼‚å¸¸</td>
<td>@Transactional(propagation = Propagation.NEVER )ä¸å¸¸ç”¨</td>
</tr>
<tr>
<td>MANDATORY</td>
<td>æŠ›å‡ºå¼‚å¸¸</td>
<td>èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td>
<td>@Transactional(propagation = Propagation.MANDATORY)ä¸å¸¸ç”¨</td>
</tr>
<tr>
<td>NESTED</td>
<td>å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td>èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­,SavePointæœºåˆ¶ï¼Œå¤–å±‚å½±å“å†…å±‚ï¼Œ å†…å±‚ä¸ä¼šå½±å“å¤–å±‚</td>
<td>@Transactional(propagation = Propagation.NESTED)ä¸å¸¸ç”¨</td>
</tr>
</tbody></table>
<p><strong>3ã€è¶…æ—¶å±æ€§(timeout)</strong></p>
<p>æŒ‡å®šäº‹åŠ¡ç­‰å¾…çš„æœ€é•¿æ—¶é—´ï¼ˆç§’ï¼‰</p>
<p>å½“å‰äº‹åŠ¡è®¿é—®æ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½è®¿é—®çš„æ•°æ®è¢«åˆ«çš„æ•°æ®è¿›è¡ŒåŠ é”çš„å¤„ç†ï¼Œé‚£ä¹ˆæ­¤æ—¶äº‹åŠ¡å°±å¿…é¡»ç­‰å¾…ï¼Œå¦‚æœç­‰å¾…æ—¶é—´è¿‡é•¿ç»™ç”¨æˆ·é€ æˆçš„ä½“éªŒæ„Ÿå·®ã€‚</p>
<p><strong>4ã€è®¾ç½®äº‹åŠ¡åªè¯»(readOnly)</strong></p>
<p>**readonly:**åªä¼šè®¾ç½®åœ¨æŸ¥è¯¢çš„ä¸šåŠ¡æ–¹æ³•ä¸­</p>
<p>â€‹        å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå•æ¡æŸ¥è¯¢è¯­å¥ï¼Œåˆ™æ²¡æœ‰å¿…è¦å¯ç”¨äº‹åŠ¡æ”¯æŒï¼Œæ•°æ®åº“é»˜è®¤æ”¯æŒSQLæ‰§è¡ŒæœŸé—´çš„è¯»ä¸€è‡´æ€§ï¼›</p>
<p>â€‹        å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œä¾‹å¦‚ç»Ÿè®¡æŸ¥è¯¢ï¼ŒæŠ¥è¡¨æŸ¥è¯¢ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¤šæ¡æŸ¥è¯¢SQLå¿…é¡»ä¿è¯æ•´ä½“çš„è¯»ä¸€è‡´æ€§ï¼Œå¦åˆ™ï¼Œåœ¨å‰æ¡SQLæŸ¥è¯¢ä¹‹åï¼Œåæ¡SQLæŸ¥è¯¢ä¹‹å‰ï¼Œæ•°æ®è¢«å…¶ä»–ç”¨æˆ·æ”¹å˜ï¼Œåˆ™è¯¥æ¬¡æ•´ä½“çš„ç»Ÿè®¡æŸ¥è¯¢å°†ä¼šå‡ºç°è¯»æ•°æ®ä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œåº”è¯¥å¯ç”¨äº‹åŠ¡æ”¯æŒï¼ˆå¦‚ï¼šè®¾ç½®ä¸å¯é‡å¤åº¦ã€å¹»å½±è¯»çº§åˆ«ï¼‰ã€‚</p>
<p>â€‹        å¯¹äºåªè¯»äº‹åŠ¡ï¼Œå¯ä»¥æŒ‡å®šäº‹åŠ¡ç±»å‹ä¸ºreadonlyï¼Œå³åªè¯»äº‹åŠ¡ã€‚ç”±äºåªè¯»äº‹åŠ¡ä¸å­˜åœ¨æ•°æ®çš„ä¿®æ”¹ï¼Œå› æ­¤æ•°æ®åº“å°†ä¼šä¸ºåªè¯»äº‹åŠ¡æä¾›ä¸€äº›ä¼˜åŒ–æ‰‹æ®µ </p>
<p><strong>5ã€å¼‚å¸¸å±æ€§</strong></p>
<p>è®¾ç½® å½“å‰äº‹åŠ¡å‡ºç°çš„é‚£äº›å¼‚å¸¸å°±è¿›è¡Œå›æ»šæˆ–è€…æäº¤ã€‚</p>
<p>é»˜è®¤å¯¹äºRuntimeException åŠå…¶å­ç±» é‡‡ç”¨çš„æ˜¯å›æ»šçš„ç­–ç•¥ã€‚</p>
<p>é»˜è®¤å¯¹äºException åŠå…¶å­ç±» é‡‡ç”¨çš„æ˜¯æäº¤çš„ç­–ç•¥ã€‚ </p>
<p> <strong>1 &gt;è®¾ç½®å“ªäº›å¼‚å¸¸ä¸å›æ»š(noRollbackFor)</strong> </p>
<p>  <strong>2&gt;è®¾ç½®å“ªäº›å¼‚å¸¸å›æ»šï¼ˆrollbackFor ï¼‰</strong></p>
<p>@Transactional(timeout = 3,rollbackFor = {FileNotFoundException.class})</p>
<p><strong>6ã€åœ¨å®æˆ˜ä¸­äº‹åŠ¡çš„ä½¿ç”¨æ–¹å¼</strong></p>
<ul>
<li><p>å¦‚æœå½“å‰ä¸šåŠ¡æ–¹æ³•æ˜¯ä¸€ç»„ å¢ã€æ”¹ã€åˆ   å¯ä»¥è¿™æ ·è®¾ç½®äº‹åŠ¡</p>
<p>@Transactional</p>
</li>
<li><p>å¦‚æœå½“å‰ä¸šåŠ¡æ–¹æ³•æ˜¯ä¸€ç»„ æŸ¥è¯¢  å¯ä»¥è¿™æ ·è®¾ç½®äº‹åŠ¡</p>
<p>@Transactionl(readOnly=true)</p>
</li>
<li><p>å¦‚æœå½“å‰ä¸šåŠ¡æ–¹æ³•æ˜¯å•ä¸ª æŸ¥è¯¢  å¯ä»¥è¿™æ ·è®¾ç½®äº‹åŠ¡</p>
<p>@Transactionl(propagation=propagation.SUPPORTS ,readOnly=true)</p>
</li>
</ul>
<p><strong>åŸºäºxmlçš„äº‹åŠ¡é…ç½®</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">Â  Â  Â  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">Â  Â  Â  <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">Â  Â  Â  <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">Â  Â  Â  <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">Â  Â  Â  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">Â  Â  Â  http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">Â  Â  Â  http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">Â  Â  Â  http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">Â  Â  Â  http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">Â  Â  Â  https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">Â  Â  Â  http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">Â  Â  Â  https://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.tulingxueyuan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:dbconfig.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;namedParameterJdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">Â  Â <span class="comment">&lt;!--äº‹åŠ¡æ§åˆ¶--&gt;</span></span><br><span class="line">Â  Â <span class="comment">&lt;!--é…ç½®äº‹åŠ¡ç®¡ç†å™¨çš„bean--&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">Â  Â <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Â  Â åŸºäºxmlé…ç½®çš„äº‹åŠ¡ï¼šä¾èµ–txåç§°ç©ºé—´å’Œaopåç§°ç©ºé—´</span></span><br><span class="line"><span class="comment">Â  Â  Â  Â 1ã€springä¸­æä¾›äº‹åŠ¡ç®¡ç†å™¨ï¼ˆåˆ‡é¢ï¼‰ï¼Œé…ç½®è¿™ä¸ªäº‹åŠ¡ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment">Â  Â  Â  Â 2ã€é…ç½®å‡ºäº‹åŠ¡æ–¹æ³•</span></span><br><span class="line"><span class="comment">Â  Â  Â  Â 3ã€å‘Šè¯‰springå“ªäº›æ–¹æ³•æ˜¯äº‹åŠ¡æ–¹æ³•ï¼ˆäº‹åŠ¡åˆ‡é¢æŒ‰ç…§æˆ‘ä»¬çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å»åˆ‡å…¥äº‹åŠ¡æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="comment">Â  Â --&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.tulingxueyuan.service.BookService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;txPoint&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* cn.tulingxueyuan.service.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="comment">&lt;!--äº‹åŠ¡å»ºè®®ï¼šadvice-ref:æŒ‡å‘äº‹åŠ¡ç®¡ç†å™¨çš„é…ç½®--&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPoint&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="comment">&lt;!--äº‹åŠ¡å±æ€§--&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="comment">&lt;!--æŒ‡æ˜å“ªäº›æ–¹æ³•æ˜¯äº‹åŠ¡æ–¹æ³•--&gt;</span></span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span>/&gt;</span></span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;checkout&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:method</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">Â  Â <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æºç è§£æï¼š</p>
<p>AutoProxyRegisterï¼šæ³¨å†ŒBeanPostProcess</p>
<p>ProxyTransactionManagementConfigurationï¼šé…ç½®ç±»</p>
<p>å¯¼å…¥Springå†…ç½®çš„Advisorï¼ˆAdviceï¼Œpointcutï¼‰</p>
<p>åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ–¹æ³•ä¸­ï¼Œå¦‚æœåœ¨æ²¡æœ‰æš´éœ²ï¼Œ<strong>å¤šä¸ªäº‹åŠ¡åµŒå¥—ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“é“¾æ¥</strong>ï¼ŒåµŒå¥—äº‹åŠ¡ä¼šè¢«æ·»åŠ åˆ°<strong>äº‹åŠ¡åŒæ­¥ç®¡ç†å™¨</strong>ä¸­</p>
<h3 id="æ›´æ–°å¾…ç»­"><a href="#æ›´æ–°å¾…ç»­" class="headerlink" title="æ›´æ–°å¾…ç»­"></a>æ›´æ–°å¾…ç»­</h3>
  </div>
  <div class="post-footer">the end</div>
</article>

          
  <nav class="pagination post-nav">
    
      <a href="/2020/12/13/2020-12-13-RockerMQ/">
        <span class="prev-post"><i class="iconfont icon-back"></i>RocketMQ</span>
      </a>
    
    
      <a href="/2020/11/28/2020-11-28-Java-BIO-NIO-AIO/">
        <span class="next-post">Java BIO NIO AIO<i class="iconfont icon-more"></i></span>
      </a>
    
  </nav>


          
  


      </main>
    </div>
    <footer>
      <div class="social-links">
        
          
            <a target="_blank" rel="noopener" href="https://www.zhihu.com/"><i class="iconfont icon-zhihu"></i></a>
          
        
          
            <a target="_blank" rel="noopener" href="https://weibo.com"><i class="iconfont icon-weibo"></i></a>
          
        
          
            <a target="_blank" rel="noopener" href="https://github.com/"><i class="iconfont icon-github"></i></a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
      
        <div class="quote">
          <p>Love all, trust a few, do wrong to none.â€”â€”William Shakespeare</p>
        </div>
      
      <div class="copyright">
        <p>
          ç”± <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> å¼ºåŠ›é©±åŠ¨
          <span>|</span>
          ä¸»é¢˜ - <a target="_blank" rel="noopener" href="https://github.com/wa-ri/hexo-theme-ztopic">ztopic</a
        </p>
        <p>
          <span>
          
          &copy;
          
            2021
          
          </span>
          <i class="iconfont icon-circle"></i>
          <span>Shope Huwang</span>
        </p>
      </div>
</footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <div id="mobile-nav">
  <nav id="mobile-nav-menu">
    
      <a href="/" class="mobile-nav-link"><i class="iconfont icon-home"></i>é¦–é¡µ</a>
    
      <a href="/archives/" class="mobile-nav-link"><i class="iconfont icon-archive"></i>å½’æ¡£</a>
    
      <a href="/about/" class="mobile-nav-link"><i class="iconfont icon-about"></i>å…³äº</a>
    
    <div class="mobile-intro"><i class="iconfont icon-pen"></i>You&#39;ll shine like a diamond</div>
  </nav>
</div>


  
<script src="/libs/jQuery/jquery-3.2.1.min.js"></script>

  
<script src="/libs/slideout/slideout.min.js"></script>

  
    
<link rel="stylesheet" href="/libs/fancybox/jquery.fancybox.css">

    
<script src="/libs/fancybox/jquery.fancybox.pack.js"></script>

  
  

  
<script src="/js/ztopic.js"></script>

</body>
</html>
